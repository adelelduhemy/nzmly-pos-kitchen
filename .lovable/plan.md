

# ุฎุทุฉ ุฅุถุงูุฉ ุดุงุช ุฐูู ูููููู ุจุงุณุชุฎุฏุงู n8n

## ูุธุฑุฉ ุนุงูุฉ

ุณูุชู ุฅุถุงูุฉ ูุงุฌูุฉ ุดุงุช ุชูุงุนููุฉ ูู ุตูุญุฉ ุงููููู ุงูุนุงู ุชุณูุญ ููุนููู ุจุงูุชุญุฏุซ ูุน ูุณุงุนุฏ ุฐูู ูุณุฃูู ุนู ุชูุถููุงุชู ูููุชุฑุญ ูู ุงูุฃุทุจุงู ุงูููุงุณุจุฉ ุจูุงุกู ุนูู ุจูุงูุงุช ุงููููู ุงููุฎุฒูุฉ.

---

## ููู ุณูุนูู ุงููุธุงูุ

```text
+-------------------+     +-------------------+     +-------------------+
|                   |     |                   |     |                   |
|   ุงูุนููู ููุชุจ     | --> |   Edge Function   | --> |   n8n Workflow    |
|   ูู ุงูุดุงุช        |     |   (Proxy)         |     |   (AI + Logic)    |
|                   |     |                   |     |                   |
+-------------------+     +-------------------+     +-------------------+
                                    |                        |
                                    v                        v
                          +-------------------+     +-------------------+
                          |                   |     |                   |
                          |   ูุงุนุฏุฉ ุงูุจูุงูุงุช  | <-- |   ุชุญููู ุงูุทูุจ     |
                          |   (Menu Items)    |     |   ูุงูุชุฑุงุญ ุงูุฃุทุจุงู |
                          |                   |     |                   |
                          +-------------------+     +-------------------+
```

---

## ุงููุฑุญูุฉ ุงูุฃููู: ุฅุนุฏุงุฏ n8n

### 1. ุฑุจุท n8n ุจู Lovable
- ุณูุชู ุงุณุชุฎุฏุงู ููุตู n8n MCP ูุฑุจุท ุงููุดุฑูุน ุจุฎุฏูุฉ n8n
- ุณุชุญุชุงุฌ ูุฅุนุฏุงุฏ Workflow ูู n8n ูุชูุนูู MCP Access

### 2. ุจูุงุก Workflow ูู n8n
ุณูุชุถูู ุงูู Workflow:
- **Webhook Trigger**: ูุงุณุชูุจุงู ุฑุณุงุฆู ุงูุดุงุช
- **AI Node**: ูุชุญููู ุฑุณุงูุฉ ุงูุนููู ูููู ุชูุถููุงุชู
- **Logic Node**: ููุนุงูุฌุฉ ุงูุฃุณุฆูุฉ ูุงุณุชุฎุฑุงุฌ ุงููุนูููุงุช
- **Response Builder**: ูุจูุงุก ุงูุงูุชุฑุงุญุงุช ูุงูุฑุฏ ุนูู ุงูุนููู

---

## ุงููุฑุญูุฉ ุงูุซุงููุฉ: Edge Function

### ููู ุฌุฏูุฏ: `supabase/functions/menu-chat/index.ts`

ุณุชููู ูุฐู ุงูุฏุงูุฉ ุจู:
1. ุงุณุชูุจุงู ุฑุณุงูุฉ ุงูุนููู ูู ุงููุงุฌูุฉ
2. ุฌูุจ ุจูุงูุงุช ุงููููู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. ุฅุฑุณุงู ุงูุฑุณุงูุฉ + ุจูุงูุงุช ุงููููู ุฅูู n8n Webhook
4. ุฅุฑุฌุงุน ุฑุฏ ุงูุฐูุงุก ุงูุงุตุทูุงุนู ููุนููู

```typescript
// ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ:
- ุงุณุชูุจุงู POST request ูุน { message, conversation_history, menu_slug }
- ุฌูุจ menu_items ู menu_categories ูู Supabase
- ุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูู n8n webhook
- ุฅุฑุฌุงุน ุงูุชุฑุงุญุงุช ุงูุฃุทุจุงู ููุนููู
```

---

## ุงููุฑุญูุฉ ุงูุซุงูุซุฉ: ูุงุฌูุฉ ุงูุดุงุช

### 1. ูููู ุฌุฏูุฏ: `src/components/public-menu/MenuChatbot.tsx`

```text
+--------------------------------+
|     ๐ฌ ูุณุงุนุฏ ุงูุทูุจ ุงูุฐูู       |
+--------------------------------+
|                                |
|  ๐ ุฃููุงู! ููู ุฃูุฏุฑ ุฃุณุงุนุฏูุ    |
|                                |
|  โ ูู ุชูุถู ุฃูู ุญุงุฑ ุฃู ุฎูููุ   |
|                                |
|  ๐ค ุฃูุถู ุฃูู ุฎููู              |
|                                |
|  ๐ฝ๏ธ ุจูุงุกู ุนูู ุฐูู ุฃูุชุฑุญ ูู:   |
|     - ุณูุทุฉ ูุชูุด (22 ุฑ.ุณ)       |
|     - ุญูุต (18 ุฑ.ุณ)             |
|                                |
+--------------------------------+
| [ุงูุชุจ ุฑุณุงูุชู ููุง...]    [ุฅุฑุณุงู] |
+--------------------------------+
```

### ูููุฒุงุช ุงููุงุฌูุฉ:
- **ุฒุฑ ุนุงุฆู (Floating Button)**: ูู ุฒุงููุฉ ุงูุดุงุดุฉ ููุชุญ ุงูุดุงุช
- **ูุงูุฐุฉ ุดุงุช ูุชุญุฑูุฉ**: ุจุชุตููู ูุชูุงูู ูุน ุงูุชูุจููุช ุงููุฎุชุงุฑ
- **ูุญููุธุงุช ุงููุญุงุฏุซุฉ**: ุชุฎุฒูู ุงููุญุงุฏุซุฉ ุฎูุงู ุงูุฌูุณุฉ
- **ุงูุชุฑุงุญุงุช ุณุฑูุนุฉ**: ุฃุฒุฑุงุฑ ุณุฑูุนุฉ ููุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ

### 2. ุฃููุงุน ุงูุฃุณุฆูุฉ ุงูุชู ุณูุทุฑุญูุง ุงูุดุงุช:

| ุงูุณุคุงู | ุงููุฏู |
|--------|-------|
| ูู ุชูุถู ุฃูู ุญุงุฑ ุฃู ุฎูููุ | ุชุตููุฉ ุงูุฃุทุจุงู ุญุณุจ ุงููููุฉ |
| ูู ุนูุฏู ุญุณุงุณูุฉ ูู ุดูุก ูุนููุ | ุงุณุชุจุนุงุฏ ุฃุทุจุงู ูุนููุฉ |
| ูู ุนุฏุฏ ุงูุฃุดุฎุงุตุ | ุงูุชุฑุงุญ ุฃุญุฌุงู ููุงุณุจุฉ |
| ูู ุชูุถู ูุญู ุฃู ุฏุฌุงุฌ ุฃู ูุจุงุชูุ | ุชุตููุฉ ุญุณุจ ุงูููุน |
| ูุง ููุฒุงููุชู ุงูุชูุฑูุจูุฉุ | ุงูุชุฑุงุญ ุถูู ูุทุงู ุณุนุฑู |

---

## ุงููุฑุญูุฉ ุงูุฑุงุจุนุฉ: ุฏูุฌ ุงูุดุงุช ูู ุงูุชูุจููุชุงุช

### ุชุญุฏูุซ ุงููููุงุช:
1. `ClassicGridTemplate.tsx` - ุฅุถุงูุฉ `<MenuChatbot />`
2. `ModernDarkTemplate.tsx` - ุฅุถุงูุฉ `<MenuChatbot />`
3. `PromoFocusedTemplate.tsx` - ุฅุถุงูุฉ `<MenuChatbot />`
4. `MinimalFastTemplate.tsx` - ุฅุถุงูุฉ `<MenuChatbot />`

---

## ุงููุฑุญูุฉ ุงูุฎุงูุณุฉ: ุชุฎุฒูู ุงูุจูุงูุงุช (ุงุฎุชูุงุฑู)

### ุฌุฏูู ุฌุฏูุฏ: `chat_sessions`
ูุชุชุจุน ุงููุญุงุฏุซุงุช ูุชุญุณูู ุงูุงูุชุฑุงุญุงุช ูุณุชูุจูุงู:

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|------|-------|
| id | uuid | ูุนุฑู ุงูุฌูุณุฉ |
| menu_slug | text | ูุนุฑู ุงููุทุนู |
| messages | jsonb | ุณุฌู ุงููุญุงุฏุซุฉ |
| suggested_items | uuid[] | ุงูุฃุทุจุงู ุงูููุชุฑุญุฉ |
| selected_items | uuid[] | ุงูุฃุทุจุงู ุงููุฎุชุงุฑุฉ |
| created_at | timestamp | ููุช ุงูุจุฏุก |

---

## ุงููููุงุช ุงูุชู ุณูุชู ุฅูุดุงุคูุง/ุชุนุฏูููุง

### ูููุงุช ุฌุฏูุฏุฉ:
1. `supabase/functions/menu-chat/index.ts` - Edge Function ููุชูุงุตู ูุน n8n
2. `src/components/public-menu/MenuChatbot.tsx` - ูุงุฌูุฉ ุงูุดุงุช
3. `src/hooks/useMenuChat.ts` - Hook ูุฅุฏุงุฑุฉ ุญุงูุฉ ุงูุดุงุช

### ูููุงุช ูุนุฏูุฉ:
1. `supabase/config.toml` - ุฅุถุงูุฉ ุฅุนุฏุงุฏุงุช Edge Function
2. `src/components/public-menu/templates/*.tsx` - ุฅุถุงูุฉ ุงูุดุงุช ููุชูุจููุชุงุช

---

## ุงูุฎุทูุงุช ุงูุชุงููุฉ ุงููุทููุจุฉ ููู

### 1. ุฅุนุฏุงุฏ n8n
ูุงุณุชุฎุฏุงู n8n ุชุญุชุงุฌ ุฅูู:

1. **ุชุณุฌูู ุญุณุงุจ** ูู n8n.cloud ุฃู ุชุดุบูู n8n ูุญููุงู
2. **ุชูุนูู MCP Access** ูู Settings โ MCP access
3. **ุฅูุดุงุก Workflow** ูุชูุนูู "Available in MCP" ูู ุฅุนุฏุงุฏุงุช ุงูู Workflow

### 2. ุจูุงูุงุช ูุทููุจุฉ
ุจุนุฏ ุฅุนุฏุงุฏ n8nุ ุณุฃุญุชุงุฌ ููู:
- **n8n Webhook URL**: ูุงุณุชูุจุงู ุฑุณุงุฆู ุงูุดุงุช

---

## ุงูุจุฏูู: ุงุณุชุฎุฏุงู Lovable AI ุจุฏูุงู ูู n8n

ุฅุฐุง ููุช ุชูุถู ุญูุงู ุฃุจุณุท ุจุฏูู ุฅุนุฏุงุฏ n8nุ ูููููุง ุงุณุชุฎุฏุงู **Lovable AI Gateway** ุงููุฏูุฌ ูุจุงุดุฑุฉ ูุงูุฐู:
- ูุง ูุญุชุงุฌ API Key ุฅุถุงูู
- ูุชุงุญ ููุฑุงู
- ูุฏุนู ููุงุฐุฌ ูุซู gemini-3-flash-preview ู gpt-5

---

## ุงููุณู ุงูุชููู

### ูููู Edge Function

```typescript
// supabase/functions/menu-chat/index.ts

// 1. ุงุณุชูุจุงู ุงูุฑุณุงูุฉ
const { message, history, menu_slug } = await req.json();

// 2. ุฌูุจ ุจูุงูุงุช ุงููููู
const menuItems = await supabase
  .from('menu_items')
  .select('*')
  .eq('is_available', true);

const categories = await supabase
  .from('menu_categories')
  .select('*')
  .eq('is_active', true);

// 3. ุจูุงุก ุงูุณูุงู ููุฐูุงุก ุงูุงุตุทูุงุนู
const systemPrompt = `
ุฃูุช ูุณุงุนุฏ ุฐูู ููุทุนู. ูุฏูู ูุงุฆูุฉ ุงูุฃุทุจุงู ุงูุชุงููุฉ:
${JSON.stringify(menuItems)}

ูููุชู:
1. ุงุณุฃู ุงูุนููู ุนู ุชูุถููุงุชู
2. ุงูุชุฑุญ ุฃุทุจุงู ููุงุณุจุฉ ูู ุงููุงุฆูุฉ
3. ุฃุฌุจ ุจุงููุบุฉ ุงูุนุฑุจูุฉ
`;

// 4. ุฅุฑุณุงู ุฅูู n8n ุฃู Lovable AI
// 5. ุฅุฑุฌุงุน ุงูุฑุฏ
```

### ูููู ูุงุฌูุฉ ุงูุดุงุช

```typescript
// src/components/public-menu/MenuChatbot.tsx

interface Message {
  id: string;
  role: 'user' | 'assistant';
  content: string;
  suggestions?: MenuItem[]; // ุงูุฃุทุจุงู ุงูููุชุฑุญุฉ
}

// ุงูุญุงูุฉ
const [isOpen, setIsOpen] = useState(false);
const [messages, setMessages] = useState<Message[]>([]);
const [isLoading, setIsLoading] = useState(false);

// ุฅุฑุณุงู ุฑุณุงูุฉ
const sendMessage = async (text: string) => {
  // ุฅุถุงูุฉ ุฑุณุงูุฉ ุงููุณุชุฎุฏู
  // ุงุณุชุฏุนุงุก Edge Function
  // ุฅุถุงูุฉ ุฑุฏ ุงูุฐูุงุก ุงูุงุตุทูุงุนู
};
```

